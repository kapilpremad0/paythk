<div class="app-content content ">
  <div class="content-overlay"></div>
  <div class="header-navbar-shadow"></div>
  <div class="content-wrapper container-xxl p-0">
    <div class="content-header row">

      <div class="content-header-right text-md-end col-md-3 col-12 d-md-block d-none">




      </div>
    </div>
    <div class="content-body">


      <!-- Bordered table start -->
      <div class="row" id="table-bordered">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <!-- Flex container to align Search and Status Filter on the same line -->

              <!-- Status filter dropdown -->
              <div class="">
                <label for="genderFilter" class="form-label">Filter by Gender</label>
                <select id="genderFilter" class="form-select">
                  <option value="">All</option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                  <option value="other">Other</option>
                </select>
              </div>

              <a href="<%= '/admin/users/create' %>" class="btn btn-primary">
                Create
              </a>


            </div>
            <div class="card-body">
              <div class="table-responsive card card-company-table">
                <script>
                  $(document).ready(function() {
                    var table = $('#categoriesTable').DataTable({
                      columnDefs: [{
                        orderable: false
                      }],

                      processing: true,
                      serverSide: true,
                      ajax: {
                        url: '/admin/users/data',
                        type: 'POST',
                        contentType: 'application/json',
                        data: function(d) {
                          // Get values from both filters
                          var search = $('#searchFilter').val(); // Get search term
                          var gender = $('#genderFilter').val(); // Get selected status

                          // Add search term and status filter to the data object
                          if (search) {
                            d.search = search; // Add the search term
                          }
                          if (gender) {
                            d.gender = gender; // Add the status filter if it's selected
                          }

                          return JSON.stringify(d); // Return the modified data object

                          feather.replace();

                        }
                      },
                      columns: [{
                          data: null,
                          render: function(data, type, row, meta) {
                            return meta.settings._iDisplayStart + meta.row + 1;
                          },
                          searchable: false,
                          orderable: false
                        },
                        {
                          data: 'name'
                        },

                        {
                          data: 'gender',
                          render: function(data, type, row) {
                            if (!data) return ''; // handle empty gender
                            return data.toUpperCase(); // convert to uppercase
                          }
                        },
                        {
                          data: 'dob',
                          render: function(data, type, row) {
                            if (!data) return '';
                            const d = new Date(data);
                            const year = d.getFullYear();
                            const month = String(d.getMonth() + 1).padStart(2, '0');
                            const day = String(d.getDate()).padStart(2, '0');
                            return `${day}-${month}-${year}`; // Format DOB as YYYY-MM-DD
                          }
                        },
                        {
                          data: 'action'
                        }
                      ],
                      drawCallback: function(settings) {
                        feather.replace(); // Ensures icons are replaced every time table is drawn
                      }
                    });

                    // Reload table when either filter or search is changed
                    $('#genderFilter, #searchFilter').on('change keyup', function() {
                      table.ajax.reload(); // Reload DataTable on change or keyup
                    });
                  });
                </script>

                <table class="table" id="categoriesTable">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Name</th>
                      <th>Gender</th>
                      <th>DOB</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>


<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteUserModal" tabindex="-1" aria-labelledby="deleteUserModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete User</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete <strong id="deleteUserName"></strong>?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" id="confirmDeleteUser" class="btn btn-danger">Delete</button>
      </div>
    </div>
  </div>
</div>



<script>
  $(document).ready(function() {
    let deleteUserId = null;

    // Open modal when delete button is clicked
    $(document).on("click", ".delete-user", function() {
      deleteUserId = $(this).data("id");
      let userName = $(this).data("name");
      $("#deleteUserName").text(userName);
      $("#deleteUserModal").modal("show");
    });

    // Confirm delete
    $("#confirmDeleteUser").on("click", function() {
      if (!deleteUserId) return;

      $.ajax({
        url: "/admin/users/" + deleteUserId, // your delete route
        type: "DELETE",
        success: function(response) {
          $("#deleteUserModal").modal("hide");
          $("#categoriesTable").DataTable().ajax.reload(); // refresh table
          showSuccessToast("User deleted successfully!");
        },
        error: function(err) {
          $("#deleteUserModal").modal("hide");
          showErrorToast("Failed to delete user!");
        }
      });
    });
  });
</script>